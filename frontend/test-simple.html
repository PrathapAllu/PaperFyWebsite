<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Auth Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .test-form { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; }
        input { width: 300px; padding: 8px; border: 1px solid #ddd; border-radius: 3px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #logs { font-family: monospace; background: #f8f9fa; padding: 10px; border: 1px solid #ddd; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Simple Authentication Test</h1>
    
    <div id="status" class="status info">Initializing...</div>
    
    <div class="test-form">
        <h3>Test Login</h3>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" value="test@example.com">
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" value="testpassword123">
        </div>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="testSignup()">Test Signup</button>
        <button onclick="testLogout()">Test Logout</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>
    
    <div id="logs"></div>

    <!-- Load Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');

        function log(message) {
            console.log(message);
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function updateStatus(message, type = 'info') {
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        function clearLogs() {
            logsDiv.innerHTML = '';
        }

        async function testLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            log('üîê Testing login...');
            try {
                const result = await authService.signIn(email, password);
                if (result.success) {
                    log('‚úÖ Login successful: ' + result.message);
                    updateStatus('Login successful', 'success');
                } else {
                    log('‚ùå Login failed: ' + result.message);
                    updateStatus('Login failed: ' + result.message, 'error');
                }
            } catch (error) {
                log('‚ùå Login error: ' + error.message);
                updateStatus('Login error: ' + error.message, 'error');
            }
        }

        async function testSignup() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            log('üìù Testing signup...');
            try {
                const result = await authService.signUp(email, password, { name: 'Test User' });
                if (result.success) {
                    log('‚úÖ Signup successful: ' + result.message);
                    updateStatus('Signup successful', 'success');
                } else {
                    log('‚ùå Signup failed: ' + result.message);
                    updateStatus('Signup failed: ' + result.message, 'error');
                }
            } catch (error) {
                log('‚ùå Signup error: ' + error.message);
                updateStatus('Signup error: ' + error.message, 'error');
            }
        }

        async function testLogout() {
            log('üö™ Testing logout...');
            try {
                const result = await authService.signOut();
                if (result.success) {
                    log('‚úÖ Logout successful: ' + result.message);
                    updateStatus('Logout successful', 'success');
                } else {
                    log('‚ùå Logout failed: ' + result.message);
                    updateStatus('Logout failed: ' + result.message, 'error');
                }
            } catch (error) {
                log('‚ùå Logout error: ' + error.message);
                updateStatus('Logout error: ' + error.message, 'error');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            log('üöÄ Starting authentication test...');
            
            try {
                // Step 1: Check Supabase
                log('‚è≥ Step 1: Checking Supabase CDN...');
                if (typeof window.supabase === 'undefined') {
                    throw new Error('Supabase CDN not loaded');
                }
                log('‚úÖ Supabase CDN loaded');

                // Step 2: Initialize Supabase client
                log('‚è≥ Step 2: Initializing Supabase client...');
                const supabaseUrl = 'https://bqemaogpiunlbdhzvlyd.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxZW1hb2dwaXVubGJkaHp2bHlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4MTcwMTIsImV4cCI6MjA3MTM5MzAxMn0.TvzBF6pdrfAOLZUDISvebqYR71zKkZOX-jDlTvOMBQg';
                
                // Store properly
                window.supabaseLib = window.supabase;
                window.supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
                window.supabase = window.supabaseLib;
                window.supabase.client = window.supabaseClient;
                
                log('‚úÖ Supabase client initialized');

                // Step 3: Load auth service
                log('‚è≥ Step 3: Loading auth service...');
                const script = document.createElement('script');
                script.src = 'auth.js';
                
                await new Promise((resolve, reject) => {
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
                
                log('‚úÖ Auth service loaded');

                // Step 4: Wait for services
                log('‚è≥ Step 4: Waiting for authService...');
                let attempts = 0;
                while (attempts < 50 && typeof authService === 'undefined') {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (typeof authService === 'undefined') {
                    throw new Error('authService not available');
                }
                log('‚úÖ authService available');

                // Step 5: Initialize authService
                log('‚è≥ Step 5: Initializing authService...');
                await authService.waitForSupabase();
                log('‚úÖ authService initialized');

                // Step 6: Test connection
                log('‚è≥ Step 6: Testing connection...');
                const connectionTest = await authService.testSupabaseConnection();
                if (!connectionTest) {
                    throw new Error('Connection test failed');
                }
                log('‚úÖ Connection test successful');

                updateStatus('All tests passed! Ready to test authentication.', 'success');
                log('üéâ All initialization tests passed!');

            } catch (error) {
                log('‚ùå Initialization failed: ' + error.message);
                updateStatus('Initialization failed: ' + error.message, 'error');
            }
        });
    </script>
</body>
</html>
